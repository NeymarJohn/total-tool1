$(document).ready(function(){window.formEl=$(options.name);var o=$("#progress");var d=$("#bar");var a=$("#percent");var m=$("fieldset");var c,r,b;var s=false;var n=0;var h=null;var f=null;var t=null;formEl.attr("role","form");$("<input>").attr({type:"hidden",id:"_csrf",name:"_csrf",value:options._csrf}).appendTo(formEl);if(options.text_direction==="rtl"){formEl.find(":input").attr("dir","rtl")}if(options.autocomplete){formEl.attr("autocomplete","on")}else{formEl.attr("autocomplete","off")}if(options.novalidate){formEl.attr("novalidate","novalidate")}else{if(formEl.attr("novalidate")!=="novalidate"){formEl.removeAttr("novalidate")}}if(options.resume){formEl.resume({key:"form_app_"+options.id})}if(options.fingerprint){Fingerprint2.get(function(u){h=Fingerprint2.x64hash128(u.map(function(v){return v.value}).join(),31)})}if(options.geolocation&&navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(function(u){f=u.coords.latitude;t=u.coords.longitude})}setInterval(l,100);var q;function l(){var u=Math.max(window.document.body.scrollHeight,window.document.body.offsetHeight,window.document.documentElement.offsetHeight);if(q!==u){Utils.postMessage({height:u});q=u}}$(window).load(function(){if(options.mode==="preview"){return false}var v=$("canvas");if(v.length>0){for(var u=0;u<v.length;u++){(function(D){var F=new SignaturePad(D),E=F.canvas.id,A="#hidden_"+E,C="#clear_"+E,G="#undo_"+E;var B=function(){var I=F.toData();if(I.length>0){var H={data:F.toData(),dataURL:F.toDataURL()};$(A).val(JSON.stringify(H))}else{$(A).val("")}$(A).trigger("change")};F.onEnd=function(){B()};var z=$("#"+E).data("color");if(z&&z.length>0&&z!=="black"){F.penColor=z}$(C).on("click",function(){F.clear();B()});$(G).on("click",function(){var H=F.toData();if(H){H.pop();F.fromData(H);B()}});formEl.on("success",function(){F.clear();B()})})(v[u])}}var w=Utils.getUrlVars()["parentUrl"];w=w&&w.length>0?decodeURIComponent(w):window.location.href;if(w&&w.length>0){formEl.find(":input").each(function(){var A=$(this);var z=Utils.getUrlVars(w)[A.attr("id")];if(!z&&A.data("alias")&&A.data("alias").length>0){z=Utils.getUrlVars(w)[A.data("alias")]}if(A.attr("type")==="checkbox"||A.attr("type")==="radio"){if(z==="true"||z==="false"){A.prop("checked",(z==="true")).trigger("change")}}else{if(z){z=decodeURIComponent(z);A.val(z).trigger("change")}}})}if(options.defaultValues){options.defaultValues=JSON.parse(options.defaultValues);$.each(options.defaultValues,function(C,A){var z=C.split("_",1).shift();var B=$("#"+C);if(z==="checkbox"||z==="radio"){B.prop("checked",A).trigger("change")}else{B.val(A).trigger("change")}})}if(options.submissionData&&options.fields){var y=JSON.parse(options.submissionData);var x=$.map(options.fields,function(A,z){return A.name});$.each(x,function(D,H){var B=H.split("_",1);var z=B[0];if(z==="selectlist"){var C=y[H];$('select[name="'+H+'[]"] option:selected').prop("selected",false);$('select[name="'+H+'[]"]').each(function(){var I=$(this);if(typeof C==="string"){$('select[name="'+H+'[]"] option[value="'+C+'"]').prop("selected",true)}else{if(Array.isArray(C)){$.each(C,function(J,K){$('select[name="'+H+'[]"] option[value="'+K+'"]').prop("selected",true)})}}})}else{if(z==="checkbox"){var A=y[H];$('input[name="'+H+'[]"]').prop("checked",false).each(function(){var I=$(this);if(typeof A!=="undefined"){$.each(A,function(J,K){if(I.val()===K){I.prop("checked",true)}})}})}else{if(z==="radio"){$('input[name="'+H+'"]').each(function(I,K){var J=$(K);if(J.val()===y[H]){J.prop("checked",true)}})}else{if(z==="matrix"){var F=$("#"+H);if(F.length===0||(F.not("input")&&!F.is("select")&&!F.is("textarea"))){F=$('input[name="'+H+'"]');if(F.length===0){F=$('input[name="'+H+'[]"]')}}if(F.is("select")){var C=y[H];$('select[name="'+H+'[]"] option:selected').prop("selected",false);$('select[name="'+H+'[]"]').each(function(){var I=$(this);if(typeof C==="string"){$('select[name="'+H+'[]"] option[value="'+C+'"]').prop("selected",true)}else{if(Array.isArray(C)){$.each(C,function(J,K){$('select[name="'+H+'[]"] option[value="'+K+'"]').prop("selected",true)})}}})}else{if(F.is(":radio")){F.each(function(I,K){var J=$(K);if(J.val()===y[H]){J.prop("checked",true)}})}else{if(F.is(":checkbox")){var A=y[H];$('input[name="'+H+'[]"]').prop("checked",false).each(function(){var I=$(this);$.each(A,function(J,K){if(I.val()===K){I.prop("checked",true)}})})}else{F.val(y[H])}}}}else{if(H.substring(0,16)==="hidden_signature"){var G=$("canvas");if(G.length>0){for(var E=0;E<G.length;E++){(function(I){var O=new SignaturePad(I);if(typeof y[H]!=="undefined"&&y[H]){var J=JSON.parse(y[H]);O.fromData(J.data)}var M=O.canvas.id;var P="#hidden_"+M;var L="#clear_"+M;var Q="#undo_"+M;var K=function(){var R={data:O.toData(),dataURL:O.toDataURL()};$(P).val(JSON.stringify(R))};$(P).val(y[H]);O.onEnd=function(){K()};var N=$("#"+M).data("color");if(N&&N.length>0&&N!=="black"){O.penColor=N}$(L).on("click",function(){O.clear();$(P).val("")});$(Q).on("click",function(){var R=O.toData();if(Array.isArray(R)&&R.length){R.pop();O.fromData(R);K()}})})(G[E])}}}else{$("#"+H).val(y[H])}}}}}})}formEl.trigger("view");formEl.find(":input").each(function(){$(this).one("change",function(){if(s===false){if(options.mode==="preview"){return false}n=(new Date()).getTime();formEl.trigger("fill")}s=true})})});window.nextStep=function(){var u=false;c=formEl.find("fieldset:visible");r=c.next();if(options.skips.length>0){for(var v=0;v<options.skips.length;v++){if(m.index(c)<options.skips[v].to){var w=m.eq(options.skips[v].to);if(m.index(c)<m.index(w)){if(options.skips[v].from==null||options.skips[v].from==m.index(c)){options.skips[v].from=m.index(c);r=w}break}}}}if(r.is("fieldset")){$.ajax({url:options.validationUrl,type:"post",data:formEl.serialize(),headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},complete:function(x,y){},beforeSend:function(y,x){var z=c.find("input:file[required]");if(z.size()>0){$.each(z,function(){if($(this).val()){x.data=x.data+"&"+$(this).attr("name")+"=1"}})}x.data=x.data+"&current_page="+m.index(c)},success:function(F){if(F!==null&&typeof F==="object"){c.find(".error-block").remove();c.find(".form-group").removeClass("has-error");$.each(F,function(I,H){var J=c.find("#"+I).closest(".form-group");if(J.size()>0){u=true;J.addClass("has-error");var G=$("<div>",{"class":"help-block error-block",html:H});J.append(G)}})}if(!u){c.hide();var C=$(".steps");if(C.size()>0){C.find(".step").eq(m.index(c)).removeClass("current");C.find(".step").eq(m.index(r)).prevAll().addClass("success");C.find(".step").eq(m.index(r)).addClass("current")}else{var x=$(".progress").first();var A=x.find(".progress-bar");var B=A.find(".percent");var D=A.find(".title");var z=A.data("titles");if(typeof z!=="undefined"){z=z.split(",");var y=z[m.index(r)];D.html(y)}var E=Math.round(100/m.size()*m.index(r))+"%";B.text(E);A.width(E)}if(r.is("fieldset")){r.show();b=c}}formEl.trigger("nextStep");Utils.postMessage({scrollToTop:"container"})},error:function(){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger");formEl.hide();Utils.postMessage({scrollToTop:"container"})}})}};window.previousStep=function(){if(b.is("fieldset")){c=formEl.find("fieldset:visible");for(var w=0;w<options.skips.length;w++){if(m.index(c)==options.skips[w].to){b=m.eq(options.skips[w].from);break}}var A=$(".steps");if(A.size()>0){A.find(".step").removeClass("success");A.find(".step").eq(m.index(c)).removeClass("current");A.find(".step").eq(m.index(b)).prevAll().addClass("success");A.find(".step").eq(m.index(b)).addClass("current")}else{var u=$(".progress").first();var y=u.find(".progress-bar");var z=y.find(".percent");var B=y.find(".title");var x=y.data("titles");if(typeof x!=="undefined"){x=x.split(",");var v=x[m.index(b)];B.html(v)}var C=Math.round(100/m.size()*m.index(b))+"%";z.text(C);y.width(C)}c.hide();b.show();b=b.prev();formEl.trigger("previousStep");Utils.postMessage({scrollToTop:"container"})}};$("input").on("keypress",function(v){if(v.keyCode==13){var u=$(v.currentTarget).parents("fieldset").find(".next");if(u.size()>0){v.preventDefault();u.click();return false}}});$(".next").click(nextStep);$(".prev").click(previousStep);formEl.ajaxForm({url:options.actionUrl,type:"post",dataType:"json",beforeSend:function(u){if(h){u.setRequestHeader("fp",h)}if(f&&t){u.setRequestHeader("lat",f);u.setRequestHeader("lng",t)}},beforeSubmit:function(y,w,x){if(options.mode==="preview"){return false}var v=false;$.each(w.find('input[type="file"]'),function(z,A){if($(A).val()){v=true}});if(v){o.show();var u="0%";d.css("width",u);a.html(u+" "+options.i18n.complete)}formEl.find(":submit").attr("disabled",true);formEl.trigger("beforeSubmit")},uploadProgress:function(y,u,x,w){var v=w+"%";d.css("width",v);a.html(v+" "+options.i18n.complete)},success:function(u){if(u.success){e();p(u)}else{g(u)}},error:function(u,w,v){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger");formEl.hide();Utils.postMessage({scrollToTop:"container"})}});function j(){$(".error-block").remove();$(".form-group").removeClass("has-error")}function e(){j();formEl.find(":submit").attr("disabled",false);if(!(options.submissionData&&options.fields)){formEl.resetForm()}o.hide()}function p(K){options.submitted=true;var y=(new Date()).getTime();var u=y-n;formEl.trigger("success",[K,u]);if(m.size()>1){var G=$(".steps");if(G.size()>0){G.find(".step").addClass("success")}else{var A=$(".progress").first();var E=A.find(".progress-bar");var w=E.find(".percent");var L=E.find(".title");L.html("Complete");w.text("100%");E.width("100%")}}if(typeof K.addon!=="undefined"){if(typeof K.addon.redirectTo!=="undefined"){var z=K.addon.redirectTo;if(window.location!==window.parent.location){Utils.postMessage({url:z})}else{window.location.href=z?z:"/"}}}var F=typeof K.confirmationType==="undefined"?options.confirmationType:K.confirmationType;var H=typeof K.message==="undefined"?options.confirmationMessage:K.message;var v=typeof K.confirmationUrl==="undefined"?options.confirmationUrl:K.confirmationUrl;var B=typeof K.confirmationSeconds==="undefined"?options.confirmationSeconds:K.confirmationSeconds;var J=typeof K.redirectToUrl==="undefined"?options.redirectToUrl:K.redirectToUrl;var x=typeof K.showOnlyMessage==="undefined"?options.showOnlyMessage:K.showOnlyMessage;var I=function(){if(window.location!==window.parent.location){Utils.postMessage({url:v})}else{window.location.href=v?v:"/"}};var C=function(){Utils.hideMessage("#messages");Utils.showMessage("#messages",H,"success");if(F===x){formEl.hide()}Utils.postMessage({scrollToTop:"container"})};if(F===J){var D=parseInt(B,10);if(D>0){C();setTimeout(function(){I()},D*1000)}else{I()}}else{C()}}function g(v){Utils.hideMessage("#messages");if(typeof v.message!=="undefined"){Utils.showMessage("#messages",v.message,"danger")}Utils.postMessage({scrollToTop:"container"});j();if(typeof v.errors!=="undefined"&&v.errors.length>0){var x=v.errors;for(k=0;k<x.length;k++){var w=$("#"+x[k].field).closest(".form-group");w.addClass("has-error");for(i=0;i<x[k].messages.length;i++){var u=$("<div>",{"class":"help-block error-block",html:x[k].messages[i]});w.append(u)}}}formEl.find(":submit").removeAttr("disabled");formEl.trigger("error",v)}formEl.on("view",function(u){Utils.postMessage({action:"view"})});formEl.on("fill",function(u){Utils.postMessage({action:"fill"})});formEl.on("nextStep",function(u){Utils.postMessage({action:"nextStep"})});formEl.on("previousStep",function(u){Utils.postMessage({action:"previousStep"})});formEl.on("beforeSubmit",function(){Utils.postMessage({action:"beforeSubmit"})});formEl.on("error",function(u,v){Utils.postMessage({action:"error",data:v})});formEl.on("success",function(u,w,v){Utils.postMessage({action:"success",data:w,completionTime:v})});if(options.analytics){(function(z,v,A,u,x,B,y){if(!z[x]){z.FA=z.FA||[];z.FA.push(x);z[x]=function(){(z[x].q=z[x].q||[]).push(arguments)};z[x].q=z[x].q||[];B=v.createElement(A);y=v.getElementsByTagName(A)[0];B.async=1;B.src=u;y.parentNode.insertBefore(B,y)}}(window,document,"script",options.tracker,"tracker"));window.tracker("newTracker","t"+options.id,options.app,{encodeBase64:false,appId:options.id});formEl.on("view",function(u){window.tracker("setCustomUrl",decodeURIComponent(Utils.getUrlVars()["url"]));window.tracker("setReferrerUrl",decodeURIComponent(Utils.getUrlVars()["referrer"]));window.tracker("trackPageView",decodeURIComponent(Utils.getUrlVars()["title"]))});formEl.on("fill",function(u){window.tracker("trackStructEvent","form","fill","start",null,null)});formEl.on("error",function(u){window.tracker("trackStructEvent","form","error",null,null,null)});formEl.on("success",function(u,w,v){window.tracker("trackStructEvent","form","submit",w.id,"time",v)})}});